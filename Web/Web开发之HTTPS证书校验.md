# Web开发之 HTTPS 证书校验
## 关于SSL证书双向认证的原理过程
HTTPS是工作于SSL层之上的HTTP协议，SSL（安全套接层）工作于TCP层之上，向应用层提供了两个基本安全服务：认证和保密。SSL有三个子协议：握手协议，记录协议和警报协议。其中握手协议实现服务器与客户端的认证与密钥交换，记录协议进行数据加密并保证数据的完整性，警报协议则规定了错误类型和处理机制。

SSL握手协议包含4个阶段，下面简单介绍每个阶段。

双向认证 SSL 协议的具体过程：

![](https://pic4.zhimg.com/80/v2-6528a47e1ec49f81171b034bea94827f_720w.webp)

1. 浏览器发送一个连接请求给安全服务器。
2. 服务器将自己的证书，以及同证书相关的信息发送给客户浏览器。
3.  客户浏览器检查服务器送过来的证书是否是由自己信赖的 CA 中心所签发的。如果是，就继续执行协议；如果不是，客户浏览器就给客户一个警告消息：警告客户这个证书不是可以信赖的，询问客户是否需要继续。
4. 接着客户浏览器比较证书里的消息，例如域名和公钥，与服务器刚刚发送的相关消息是否一致，如果是一致的，客户浏览器认可这个服务器的合法身份。
5.  服务器要求客户发送客户自己的证书。收到后，服务器验证客户的证书，如果没有通过验证，拒绝连接；如果通过验证，服务器获得用户的公钥。
6.  客户浏览器告诉服务器自己所能够支持的通讯对称密码方案
7.  服务器从客户发送过来的密码方案中，选择一种加密程度最高的密码方案，用客户的公钥加过密后通知浏览器。
8. 浏览器针对这个密码方案，选择一个通话密钥，接着用服务器的公钥加过密后发送给服务器。
9. 服务器接收到浏览器送过来的消息，用自己的私钥解密，获得通话密钥。
10. 服务器、浏览器接下来的通讯都是用对称密码方案，对称密钥是加过密的。

上面所述的是双向认证 SSL 协议的具体通讯过程，这种情况要求服务器和用户双方都有证书。

## SSL 双向认证的例子
首先创建服务器端私有密钥和公共密钥

```
1, keytool -genkey -alias clientkey -keystore kserver.ks  
密码: serverpass  
2, keytool -export -alias serverkey -keystore kserver.ks -file server.crt  
3, keytool -import -alias serverkey -file server.crt -keystore tclient.ks  
密码: clientpublicpass
```

下面创建客户器端私有密钥和公共密钥
