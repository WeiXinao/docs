# 第六章 总线

## 6.1 总线概述

数据总线有可能并行的传输很多bit信息

![image-20220817095817045](assets/image-20220817095817045.png)

![image-20220817100124052](assets/image-20220817100124052.png)

![image-20220817100228909](assets/image-20220817100228909.png)

![总线-导出](assets/%E6%80%BB%E7%BA%BF-%E5%AF%BC%E5%87%BA.png)

> USB就是一种总线标准
>
> 当我们规定了总线的设计标准之后，各个硬件设备的生产商==遵守这个标准==就会保证自己生产的这个硬件设备可以完美的适配我们的电脑或手机。 

### 6.1.1 总线的定义

![image-20220817103553475](assets/image-20220817103553475.png)

![image-20220817103630548](assets/image-20220817103630548.png)

为什么要使用总线？

早期计算机外部设备少时大多采用分散连接方式，不易实现随时增减外部设备。为了更好地解决I/O设备和主机之间连接是灵活性问题，计算机的结构从分散连接发展为总线连接。

### 6.1.2 总线的特性

![image-20220817104332757](assets/image-20220817104332757.png)

### 6.1.3 总线的性能指标

![image-20220817124750778](assets/image-20220817124750778.png)

![image-20220817125044402](assets/image-20220817125044402.png)

![image-20220817125534256](assets/image-20220817125534256.png)

![image-20220817125831546](assets/image-20220817125831546.png)

使用总线服用技术，当我们要传递地址信息或数据信息的时候，至少需要两个总线周期。

**信号线**：最小的物理的导线，即只能传输一个bit的线，就是信号线。

**信号线数**：地址总线、数据总线和控制总线3种总线数的总和称为信号线数，如：

地址总线：64根，数据总线：32根，控制总线：100根

信号线数：$64+32+100$。

![image-20220817131151843](assets/image-20220817131151843.png)



### 6.1.4 总线的分类

![总线的分类-导出](assets/%E6%80%BB%E7%BA%BF%E7%9A%84%E5%88%86%E7%B1%BB-%E5%AF%BC%E5%87%BA.png)

#### 6.1.4.1 串行总线与并行总线

|      |                           串行总线                           |                           并行总线                           |
| :--: | :----------------------------------------------------------: | :----------------------------------------------------------: |
| 优点 | 只需要一条传输线，成本低廉，广泛应用于长距离传输；应用于计算机内部时，可以节省布线空间。 |        总线的逻辑时序比较简单，电路实现起来比较容易。        |
| 缺点 | 在数据发送和接收的时候要进行拆卸和装配，要考虑串行-并行转换的问题。 | 信号线数量多，占用更多的布线空间；远距离传输陈本高昂；由于工作频率较高时，并行的信号线之间会产生严重干扰，对每条信号线等长的要求也会变高，所以无法继续提升工作效率 |

> 并行总线==不一定==比串行总线传输地快。

![image-20220817110518051](assets/image-20220817110518051.png)

#### 6.1.4.2 系统总线

![image-20220817110604618](assets/image-20220817110604618.png)

![image-20220817111116253](assets/image-20220817111116253.png)

![image-20220817111811770](assets/image-20220817111811770.png)

##### 6.1.4.2.1 单总线结构

![image-20220817112125128](assets/image-20220817112125128.png)

缺点2：

CPU和主存是比较快速的，很多外部设备（键盘、鼠标、打印机）这些外设，它们对数据的传输速度很慢，快速的系统总线速度会被浪费。

##### 6.1.4.2.2 双总线结构

![image-20220817112824926](assets/image-20220817112824926.png)

##### 6.1.4.2.3 三总线结构

![image-20220817113221236](assets/image-20220817113221236.png)

![image-20220817113308075](assets/image-20220817113308075.png)

这三个总线，同一时刻，只能有一个总线在工作，这就导致系统的工作效率较低。

![image-20220817113554603](assets/image-20220817113554603.png)

![image-20220817113647521](assets/image-20220817113647521.png)

![image-20220817113821500](assets/image-20220817113821500.png)

![image-20220817113821744](assets/image-20220817113821744.png)

## 6.2 总线仲裁

![image-20220817162320617](assets/image-20220817162320617.png)

### 6.2.1 总线总裁的基本概念

![image-20220817162659044](assets/image-20220817162659044.png)

==总线控制器==可能被集成在CPU内部，也有可能被集成在桥接器。

### 6.2.2 集中仲裁方式

#### 6.2.2.1 链式查询方式

![image-20220817164101799](assets/image-20220817164101799.png)

**流程**：

- 当有一个或多个设备想要占有总线的控制权的时候，会想BR发送一个请求信号
- 总线控制部件发现BR信号为1是，会通过BG发送一个总线允许信号
- 这个总线允许信号会经过一个个的设备接口
  - 当这个设备不想占用总线控制权的时候，会让这个请求允许信号流过
  - 当这个设备想占有总线控制器的时候，会将请求允许信号截断, 并向BS发送一个总线忙信号
- 当总线控制器发现总线慢信号后，就会撤销总线允许信号

缺点：对故障敏感，当有一个设备出故障时，后面的设备将用于无法接受到总线控制部件发送的信号。

![image-20220817164253931](assets/image-20220817164253931.png)

#### 6.2.2.2 计数器查询方式

![image-20220817170152384](assets/image-20220817170152384.png)

#### 6.2.2.3 独立请求方式

![image-20220817170501915](assets/image-20220817170501915.png)

![image-20220817170755034](assets/image-20220817170755034.png)

![image-20220817170904431](assets/image-20220817170904431.png)

![image-20220817171041378](assets/image-20220817171041378.png)

![总线仲裁](assets/%E6%80%BB%E7%BA%BF%E4%BB%B2%E8%A3%81.png)

## 6.3  总线操作和定时

![image-20220817174428482](assets/image-20220817174428482.png)

![总线定时-导出](assets/%E6%80%BB%E7%BA%BF%E5%AE%9A%E6%97%B6-%E5%AF%BC%E5%87%BA.png)

![image-20220817184244945](assets/image-20220817184244945.png)

![image-20220817184341621](assets/image-20220817184341621.png)

![image-20220817184642374](assets/image-20220817184642374.png)

![image-20220817184942059](assets/image-20220817184942059.png)

![image-20220817185341914](assets/image-20220817185341914.png)

![image-20220817185508421](assets/image-20220817185508421.png)

![image-20220817185943348](assets/image-20220817185943348.png)

![image-20220817190312993](assets/image-20220817190312993.png)

![image-20220817190425516](assets/image-20220817190425516.png)

![总线操作和定时](assets/%E6%80%BB%E7%BA%BF%E6%93%8D%E4%BD%9C%E5%92%8C%E5%AE%9A%E6%97%B6.png)

## 6.4 总线标准

![image-20220817192233397](assets/image-20220817192233397.png)
