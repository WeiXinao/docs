

# 第三章-数据链路层

![数据链路层](assets/%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82.png)

## 3.1 功能概述

![image-20220814154600047](assets/image-20220814154600047.png)

自下而上封装，自上而下解封装。

可以想象成在同一层自左向右水平发送。

![image-20220814155033724](assets/image-20220814155033724.png)

![image-20220814155313705](assets/image-20220814155313705.png)

![数据链路层功能概述](assets/%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82%E5%8A%9F%E8%83%BD%E6%A6%82%E8%BF%B0.png)

![image-20220814160400272](assets/image-20220814160400272.png)

**链路管理**：数据链路层连接的建立、维持和释放过程称为**链路管理**，它主要用于面向连接的服务。在多个站点共享同一信道的情况下（如局域网中）如何要求**通信站点间的分配**和**管理信道**也属于数据链路层管理管理的范畴。

**透明传输**就是不管所传数据是什么样的比特组合，都应该能在链路上传送。

## 3.2 封装成帧&透明传输

### 3.2.1 分装成帧

![image-20220814164350488](assets/image-20220814164350488.png)

组帧是在发送端做的事

以太网帧格式：

![img](https://xiaoxin-typora-images.oss-cn-hangzhou.aliyuncs.com/img/6-191106130541362.gif)

![image-20220814164448560](assets/image-20220814164448560.png)

#### 3.2.1.1  字符记数法

![image-20220814164826826](assets/image-20220814164826826.png)

#### 3.2.1.2 字符（节）填充法

![image-20220814165102937](assets/image-20220814165102937.png)

![image-20220814165307017](assets/image-20220814165307017.png)

#### 3.2.1.3  零比特填充法

![image-20220814165542214](assets/image-20220814165542214.png)

#### 3.2.1.4 违规编码法

![image-20220814165717698](assets/image-20220814165717698.png)

## 3.3 差错控制

![image-20220814171854253](assets/image-20220814171854253.png)

**注意**：对于链路层的差错控制，我们是在任何一个结点的链路层都能实现的，每一个结点和它下一个相连的结点就构成了发送方和接收方的关系。

### 3.3.1 检错编码

![image-20220814172824674](assets/image-20220814172824674.png)

####  3.3.1.1 奇偶校验码

![image-20220814173213744](assets/image-20220814173213744.png)

#### 3.3.1.2 CRC冗余校验码

![image-20220814174005960](assets/image-20220814174005960.png)

![image-20220814174704316](assets/image-20220814174704316.png) 

![image-20220814174837495](assets/image-20220814174837495.png)

![image-20220814175052712](assets/image-20220814175052712.png)

### 3.3.2 纠错编码——海明码

![image-20220814175338129](assets/image-20220814175338129.png)

![image-20220814175510934](assets/image-20220814175510934.png)

![image-20220814180040809](assets/image-20220814180040809.png)

如果这个编码习系统的码距为d，就可以检测出d-1位的比特错。要检测出d位错，码距就需要为d+1。

如果要检测出d位错，码距需要为d+1；如果需要纠正d位错，需要的码距为2d+1。

#### 3.3.2.1 确认校验码位数r

![image-20220814190949916](assets/image-20220814190949916.png)

#### 3.3.2.2 确认校验码位置

![image-20220814191225320](assets/image-20220814191225320.png)

#### 3.3.2.3 添上校验码

![image-20220814191527939](assets/image-20220814191527939.png)

#### 3.3.2.4 检错并纠错

![image-20220814191800579](assets/image-20220814191800579.png)

![image-20220814191944037](assets/image-20220814191944037.png)

![差错控制-导出](assets/%E5%B7%AE%E9%94%99%E6%8E%A7%E5%88%B6-%E5%AF%BC%E5%87%BA.jpg)

## 3.4 流量控制和可靠传输机制

### 3.4.1 流量控制、可靠传输和滑动窗口机制

![image-20220828180336665](assets/image-20220828180336665.png)

![image-20220828180957054](assets/image-20220828180957054.png)

在链路层的滑动窗口协议当中，这个窗口的大小在传输过程当中是固定的。

![image-20220828181535787](assets/image-20220828181535787.png)

![image-20220828181646688](assets/image-20220828181646688.png)

### 3.4.2 停止-等待协议

在计算机网络发展的前期，通信链路质量不是很好，所以链路层就要担负起可靠传输的职责，因此链路层就会使用停止-等待协议、后退N帧协议、选择重传协议等等，随着现在技术的发展我们通信链路的质量越来越好，出现差错的可能性就不像以前那么大，那么链路层就能抛弃掉可靠传输的职责，把这个责任交给传输层来实现。而链路层，主要负责差错的控制，这样就会使得我们数据在链路上进行传递的过程中，速度更快，所用的时间更少，延迟也就更小。

传输层发送的数据称为分组，而在链路层传输的时候，我们就会把这个数据称作一个数据帧。

 ![各层传输的数据](assets/%E5%90%84%E5%B1%82%E4%BC%A0%E8%BE%93%E7%9A%84%E6%95%B0%E6%8D%AE.png)

**原理**：”停止-等待“就是每发送完一个分组就停止发送，等待对方确认，收到确认后在发送下一个分组。

![image-20220828190356800](assets/image-20220828190356800.png)

![image-20220828190626264](assets/image-20220828190626264.png)

上图中：

- `ACK 0`表示对0帧的确认
- 第一个==0帧==和第二个==0帧==表示的并不是一个帧，是两个不同的帧使用的同一个编号。
- 每发送1个数据帧就停止并等待，因此用1bit来编号就够了。 

![image-20220828191850969](assets/image-20220828191850969.png)

1. 超时重传是自动的，只要超过这个世间，发送方，就会自动再去重新发送一个帧。
2. 发送完一个帧后，必须保存它的副本。
3. 数据帧和确认帧必须编号。

**注意**：如果接受方发现接收到的数据帧出错了，就会把这个数据帧丢弃掉，而接受方在经过一个超时重传时间后，每收到确认帧，那么就会把上一次发送的帧，重新发送一遍。

![image-20220828192332782](assets/image-20220828192332782.png)

![image-20220828192702754](assets/image-20220828192702754.png)

![image-20220828193013193](assets/image-20220828193013193.png)

![image-20220828193249264](assets/image-20220828193249264.png)

 ![image-20220828193706799](assets/image-20220828193706799.png)

### 3.4.3 后退N帧协议（GBN）

每个在发送中的数据帧都要有一个确定的序号。

![image-20220828194850277](assets/image-20220828194850277.png)

在收到多个帧后，接收方不用一个个的确认，它可以一起确认，比如，接收方发发送==ACK 3==表示==帧0，帧1，帧2，帧3==它都收到了。

![image-20220828195704399](assets/image-20220828195704399.png)

 ![image-20220828200040407](assets/image-20220828200040407.png)

![image-20220828200530474](assets/image-20220828200530474.png)

![image-20220828200923598](assets/image-20220828200923598.png)

![image-20220828201259373](assets/image-20220828201259373.png)

![image-20220828201614248](assets/image-20220828201614248.png)

> 收到3号帧的确认，表示0~3号帧，全部都正确接收了。

![image-20220828201740434](assets/image-20220828201740434.png)

![image-20220828203311552](assets/image-20220828203311552.png)

> 解：
>
> 甲传输1000个帧的时延：$1000 \times 1000byte * 8bit \div 100Mb/s = 8 \times 10^{-2}s = 80ms$ 
>
> 甲收到第一个帧的确认帧所需时间：$2 \times 50ms + 1000 \times 8bit \div 100Mb/s = 0.08ms + 100ms = 100.08ms$ 
>
> 最大平均数据传输率：$1000 * 1000byte \times 8bit \div 100.8ms \approx 80Mb/s$        

![image-20220828203419601](assets/image-20220828203419601.png)

![image-20220828203502936](assets/image-20220828203502936.png)

### 3.4.4 选择重传协议（Selective Repeat）

![image-20220828205134446](assets/image-20220828205134446.png)

![image-20220828205532248](assets/image-20220828205532248.png)

![image-20220828205920461](assets/image-20220828205920461.png)

![image-20220828210458332](assets/image-20220828210458332.png)

![image-20220828211137413](assets/image-20220828211137413.png)

![image-20220828211606117](assets/image-20220828211606117.png)

![image-20220828211821404](assets/image-20220828211821404.png)

![image-20220828211947336](assets/image-20220828211947336.png)

## 3.5 介质访问控制

### 3.5.1 信道划分介质访问控制

![image-20220829214913134](assets/image-20220829214913134.png)

![image-20220829215043460](assets/image-20220829215043460.png)

![image-20220829225108058](assets/image-20220829225108058.png)

![image-20220829225319718](assets/image-20220829225319718.png)

![image-20220829225504524](assets/image-20220829225504524.png)

![image-20220829225651023](assets/image-20220829225651023.png)

![image-20220829230219703](assets/image-20220829230219703.png)

![image-20220829230659828](assets/image-20220829230659828.png)

![image-20220829230924699](assets/image-20220829230924699.png)

![image-20220829231507007](assets/image-20220829231507007.png)

![image-20220830013041850](assets/image-20220830013041850.png)

![image-20220830013228144](assets/image-20220830013228144.png)

### 3.5.2 ALOHA协议

![image-20220901155953896](assets/image-20220901155953896.png)

![image-20220901160129871](assets/image-20220901160129871.png)

![image-20220901160546118](assets/image-20220901160546118.png)

​	![image-20220901162046221](assets/image-20220901162046221.png)

### 3.5.3 CSMA协议

![image-20220901163601655](assets/image-20220901163601655.png)

![image-20220901163901973](assets/image-20220901163901973.png)

![image-20220901165601615](assets/image-20220901165601615.png)

![image-20220901165858226](assets/image-20220901165858226.png)

![image-20220901170232676](assets/image-20220901170232676.png)

![image-20220901170539408](assets/image-20220901170539408.png)

|          | 1-坚持CSMA   | 非坚持CSMA                     | p-坚持CSMA                                   |
| -------- | ------------ | ------------------------------ | -------------------------------------------- |
| 信道空闲 | 马上发       | 马上发                         | p概率马上发<br />1-p概率等到下一个时隙再发送 |
| 信道忙   | 继续持续监听 | 放弃监听，等一个随机时间再监听 | 持续监听，直到信道空闲再以p概率发送          |

### <font color="red">3.5.4 CSMA/CD协议</font>

![image-20220901173746699](assets/image-20220901173746699.png)

![image-20220901174419055](assets/image-20220901174419055.png)

![image-20220901175432300](assets/image-20220901175432300.png)

![image-20220901175653115](assets/image-20220901175653115.png)

![image-20220901175853104](assets/image-20220901175853104.png)

![image-20220901180310823](assets/image-20220901180310823.png)

![image-20220901180441762](assets/image-20220901180441762.png)

![image-20220901180549156](assets/image-20220901180549156.png)

![image-20220901180717802](assets/image-20220901180717802.png)

![image-20220901180757558](assets/image-20220901180757558.png)

以太网为了达到最短帧长，对于一个比较短的帧，它会对其进行一个填充。

![image-20220901181438185](assets/image-20220901181438185.png)

### 3.5.5 CSMA/CA协议

CSMA/CA$\to$无线局域网

CSMA/CD$\to$总线式以太网

![image-20220901182454132](assets/image-20220901182454132.png)

![image-20220901183140222](assets/image-20220901183140222.png)

CSMA/CA协议的重传有上限，但是上限具体是多少，不做具体要求，知道有这回事即可。

![image-20220901183532667](assets/image-20220901183532667.png)

### 3.5.6 轮询访问介质访问控制

![image-20220901185005735](assets/image-20220901185005735.png)

#### 3.5.6.1 轮询协议

![image-20220901185503990](assets/image-20220901185503990.png)

#### 3.5.6.2 令牌传递协议

![image-20220901190254655](assets/image-20220901190254655.png)

![image-20220901190324080](assets/image-20220901190324080.png)

 ### 3.5.7 总结

![动态分配信道](assets/%E5%8A%A8%E6%80%81%E5%88%86%E9%85%8D%E4%BF%A1%E9%81%93.png)

### 3.5.8 习题

![image-20220908005742149](assets/image-20220908005742149.png)

![image-20220908005941798](assets/image-20220908005941798.png)

![image-20220908010454355](assets/image-20220908010454355.png)

## 3.6 局域网

### 3.6.1 局域网的基本概念和体系结构

![image-20220908014337000](assets/image-20220908014337000.png)

![image-20220908014836662](assets/image-20220908014836662.png)

![image-20220908015008404](assets/image-20220908015008404.png)

以太网是一种逻辑上的总线型拓扑结构。

![image-20220908015351478](assets/image-20220908015351478.png)

![image-20220908015803613](assets/image-20220908015803613.png)

令牌环网：逻辑上的拓扑结构是==环型==的，物理上的拓扑结构是==星型==的，逻辑拓扑和物理拓扑不一定是一样的，物理拓扑受现实的制约，而逻辑拓扑受通信思想的制约。

按介质访问控制的方法来分类：

![image-20220908015822370](assets/image-20220908015822370.png)

FFDDI：光纤分布式数据接口，光纤的造价不低，使用很少。

**WIFI**：WIFI是无线局域网的一种<mark style="background-color:skyblue">应用</mark>，无线局域网的覆盖范围可以比WIFI更大。

![image-20220908020528701](assets/image-20220908020528701.png)

![image-20220908020641253](assets/image-20220908020641253.png)

| 网络       | 标准        |
| ---------- | ----------- |
| 以太网[^1] | IEEE 802.3  |
| 令牌环网   | IEEE 802.5  |
| FDDI网     | IEEE 802.8  |
| 无线局域网 | IEEE 802.11 |

[^1]: 以太网也称为802.3局域网

​	![image-20220908024749007](assets/image-20220908024749007.png)

![image-20220908025658073](assets/image-20220908025658073.png)

所有和物理层传输媒体有关的内容，都会放到MAC子层中，MAC子层和物理层相关，LLC子层为网络层进行服务

![image-20220908025953676](assets/image-20220908025953676.png)

### 3.6.2 以太网

![image-20220908030712390](assets/image-20220908030712390.png)

![image-20220908030944121](assets/image-20220908030944121.png)

![image-20220908031200961](assets/image-20220908031200961.png)

![image-20220908031429228](assets/image-20220908031429228.png)

![image-20220908031753697](assets/image-20220908031753697.png)

![image-20220908031832947](assets/image-20220908031832947.png)

![image-20220908031912452](assets/image-20220908031912452.png)

![image-20220908033301578](assets/image-20220908033301578.png)

目的地址：分为单播地址，广播地址和多播地址。

类型：指明上面的网络层使用的是什么==协议==，一般把收到的MAC帧上交给上一层的这个协议。

MTU：最大数据传输单元

46是怎么算出来的？答：以太网中最小帧长是64Byte，$64Byte - 6Byte - 6Byte - 2Byte = 46Byte$

FCS：CRC的4Byte检验序列。

![image-20220908033326342](assets/image-20220908033326342.png)

![image-20220908033541471](assets/image-20220908033541471.png)

![image-20220908033601188](assets/image-20220908033601188.png)

### 3.6.3 无线局域网

![image-20220908195609220](assets/image-20220908195609220.png)

![image-20220908195654724](assets/image-20220908195654724.png)

AP指无线接入点，也就是基站。

![image-20220908200340382](assets/image-20220908200340382.png)

![image-20220908200353678](assets/image-20220908200353678.png)

![image-20220908200759117](assets/image-20220908200759117.png)

![image-20220908201031930](assets/image-20220908201031930.png)

几个基本的服务集结合，就组成了扩展的服务集。

WIFI的名字：服务集标识符，每一个对应的都是一个基站，即一个无线接入点。

![image-20220908201301412](assets/image-20220908201301412.png)

### 3.6.4 VLAN基本概念与基本原理

![image-20220908201522765](assets/image-20220908201522765.png)

![image-20220908201757120](assets/image-20220908201757120.png)

![image-20220908202013685](assets/image-20220908202013685.png)

![image-20220908202344943](assets/image-20220908202344943.png)

![image-20220908202459257](assets/image-20220908202459257.png)

![image-20220908202555731](assets/image-20220908202555731.png)

trunk端口

![image-20220908202919527](assets/image-20220908202919527.png)

![image-20220908203121788](assets/image-20220908203121788.png)

![image-20220908203321394](assets/image-20220908203321394.png)

![image-20220908204001797](assets/image-20220908204001797.png)

![image-20220908204217583](assets/image-20220908204217583.png)

![image-20220908204451153](assets/image-20220908204451153.png)

![image-20220908204628777](assets/image-20220908204628777.png)

![image-20220908204849608](assets/image-20220908204849608.png)

## 3.7 广域网

![image-20220908230935978](assets/image-20220908230935978.png)

**结点交换机**只能在==单个网络==中转发分组

**路由器**可以在==多个网络==之间转发分组

广域网是只有结点交换机吗？在广域网中可以有交换机，集线器，路由器。

**局域网**中通常采用==多点接入技术==，而广域网中通常采用==点对点==。

**广域网**强调资源的共享，而在**局域网**中比较强调数据传输。

![image-20220908231631861](assets/image-20220908231631861.png)

PPP协议只支持全双工链路。

![image-20220908232241057](assets/image-20220908232241057.png)

异步线路中的逐个字节，逐个字符来发送的，而同步线路是逐个比特来发送的。

![image-20220908232346455](assets/image-20220908232346455.png)

![image-20220908232619351](assets/image-20220908232619351.png)

![image-20220908232747679](assets/image-20220908232747679.png)

![image-20220909023626454](assets/image-20220909023626454.png)

![image-20220909024215861](assets/image-20220909024215861.png)

![image-20220909024456095](assets/image-20220909024456095.png)

![image-20220909024911210](assets/image-20220909024911210.png)

![image-20220909024919927](assets/image-20220909024919927.png)

如果采用正常相应方式和异步响应方式，地址位填充的都是从站的地址。如果是异步平衡方式，我们填充的就是一个对应站，应答站，也就是对方的地址。

控制C帧的类型：“无奸细”

![image-20220909025330073](assets/image-20220909025330073.png)

![image-20220909025429634](assets/image-20220909025429634.png)

![image-20220909025727999](assets/image-20220909025727999.png)

## 3.8 数据链路层设备

![image-20220909032306568](assets/image-20220909032306568.png)

![image-20220909032537642](assets/image-20220909032537642.png)

好处：

1. 跨域的通信
2. 扩大了以太网覆盖的地理范围

坏处：

1. 发生冲突的概率会变大，实际的通信效率也会降低

   集线器会从所有的端口转发出去


![image-20220909170731307](assets/image-20220909170731307.png)

![image-20220909171629007](assets/image-20220909171629007.png)

转发表并不是一层不变的，它会几分钟更新一次，每次更新，它就会把原来的记录全部删除，然后再通过自学习，完善转发表。

![image-20220909181237779](assets/image-20220909181237779.png)

![image-20220909181652155](assets/image-20220909181652155.png)

![image-20220909182243506](assets/image-20220909182243506.png)

![image-20220909182413366](assets/image-20220909182413366.png)

![image-20220909230724820](assets/image-20220909230724820.png)

![image-20220909231052380](assets/image-20220909231052380.png)

![image-20220909231149529](assets/image-20220909231149529.png)

![image-20220909231300240](assets/image-20220909231300240.png)

![image-20220909231417515](assets/image-20220909231417515.png)



## 3.9 总结

![image-20220909232224346](assets/image-20220909232224346.png)

![image-20220909232314526](assets/image-20220909232314526.png)

![image-20220909232510964](assets/image-20220909232510964.png)

![image-20220909232650168](assets/image-20220909232650168.png)

![image-20220909232704150](assets/image-20220909232704150.png)
